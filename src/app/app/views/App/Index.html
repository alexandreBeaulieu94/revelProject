<html>
<head>
    <title>Ultimate Tic Tac Toe</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
</head>
<body>
    <table class="big_table live" style="width:400px; height:400px;">
        <tr class="1">
            <td class="1">
                <table class="little_table col-1 row-1">
                    <tr class="1">
                        <td class="1" id="test"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="2">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="3">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                </table>
            </td>
            <td class="2">
                <table class="little_table col-2 row-1">
                    <tr class="1">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="2">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="3">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                </table>
            </td>
            <td class="3">
                <table class="little_table col-3 row-1">
                    <tr class="1">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="2">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="3">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr class="2">
            <td class="1">
                <table class="little_table col-1 row-2">
                    <tr class="1">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="2">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="3">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                </table>
            </td>
            <td class="2">
                <table class="little_table col-2 row-2">
                    <tr class="1">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="2">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="3">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                </table>
            </td>
            <td class="3">
                <table class="little_table col-3 row-2">
                    <tr class="1">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="2">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="3">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                </table>
            </td>
        </tr>
        <tr class="3">
            <td class="1">
                <table class="little_table col-1 row-3">
                    <tr class="1">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="2">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="3">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                </table>
            </td>
            <td class="2">
                <table class="little_table col-2 row-3">
                    <tr class="1">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="2">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="3">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                </table>
            </td>
            <td class="3">
                <table class="little_table col-3 row-3">
                    <tr class="1">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="2">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                    <tr class="3">
                        <td class="1"></td>
                        <td class="2"></td>
                        <td class="3"></td>
                    </tr>
                </table>
            </td>
        </tr>
    </table>
    <div id="turn" class="blue">
        Blue&rsquo;s turn&hellip;
    </div>
    <button id="newGame" onClick="location.reload();">New game</button>
</body>

<style>
    body {
        margin: 0;
        background-image: url("bg.png");
    }

    .little_table.live,
    .big_table.live {
        border: 1px yellow solid;
    }

    .little_table td {
        border: 1px black solid;
        background-color: #F5F5F5;
        cursor: pointer;
    }

    .big_table {
        border: 1px transparent solid;
        margin: 0 auto 20px;
        width: 600px;
        height: 600px;
    }

    .little_table {
        border: 1px transparent solid;
        width: 100%;
        height: 100%;
    }

    td.red {
        background-color: black;
    }

    td.blue {
        background-color: #aaaaff;
    }



    .blue {
        background-color: #010026;
        color: #010021;
    }

    .red {
        background-color: #800000;
        color: #260000;
    }

    div.marker {
        margin: auto;
        height: 100%;
        width: 100%;
        border-radius: 100%;
    }

    #turn {
        width: 560px;
        margin: auto;
        box-shadow: 0 0 5px 5px #0A0A0A;
        text-align: center;
        padding: 20px;
        font-size: 40px;
        font-family: Arial;
        text-shadow: 1px 1px 2px #ffffff;
    }

    #newGame {
        width: 400px;
        margin: auto;
        font-size: 40px;
        font-family: Arial;
        text-shadow: 1px 1px 2px #FFFFFF;
        padding: 20px;
        text-align: center;
        box-shadow: 0 0 5px 5px #0A0A0A;
        background-color: #08A300;
        color: #056900;
        text-shadow: 1px 1px 2px #ffffff;
        border: none;
        display: none;
        cursor: pointer;
    }

</style>

<script>
    /**
     * By @andylolz
     * https://github.com/andylolz/ultimate-tic-tac-toe
     *
     * code heavily based upon:
     * https://github.com/josephwegner/node-tac-toe
     */
    $(document).ready(function() {
        // click listener
        $(".little_table").find("td:not(.filled)").click(function() {
            if($(this).closest('.live').length === 0) {
                // the clicked td wasn't live
                return;
            }

            // whose turn is it?
            var colour = $("#turn").hasClass("red") ? "red" : "blue";

            // get a few useful jquery objects
            little_table = $(this).closest('.little_table');
            little_col = $(this).attr('class');
            little_row = $(this).closest('tr').attr('class');

            // we use this a couple of times
            little_pos = '.col-' + little_col + '.row-' + little_row;

            // update the 'live' yellow box
            $(".live").removeClass('live');
            if($(".little_table" + little_pos + " td").not('.filled').length === 0) {
                // that board is full, so it's a free-for-all!
                $(".big_table").addClass('live');
            } else {
                // update the live board
                $(".little_table" + little_pos).addClass('live');
            }

            var div = $("<div>").addClass("marker").addClass(colour).addClass('col-' + little_col).addClass('row-' + little_row);
            $(this).html(div); // add the marker
            $(this).addClass("filled"); // mark the td as filled
            $(this).unbind("click"); // prevent this td being clicked again

            markers = little_table.find(".marker").filter("." + colour);

            if(threeInRow(markers) || threeInColumn(markers) || threeInDiagonal(markers)) {
                // mark this board as won
                little_table.addClass(colour);
                if(colour === 'red') {
                    // add a feint red bg.
                    // Classes mess other stuff up, so this is the easiest way to do it
                    little_table.find('td').css('backgroundColor', '#ffaaaa');
                } else {
                    // add a feint blue bg
                    little_table.find('td').css('backgroundColor', '#aaaaff');
                }
            }

            // repeat the above, but for the big board
            markers = $('.little_table').filter("." + colour);

            if(threeInRow(markers) || threeInColumn(markers) || threeInDiagonal(markers)) {
                // hooray!
                win();
            } else {
                if($("td").not('.filled').length === 0) {
                    // wow - what a boring game!
                    $("#turn").fadeOut(500, function() {
                        showNewGame();
                    });
                } else {
                    // switch turns
                    $("#turn").removeClass(colour).addClass((colour === "red") ? "blue" : "red");
                    $("#turn").html(((colour === "red") ? "Blue" : "Red") + "&rsquo;s turn&hellip;");
                }
            }
        });
    });

    function win() {
        var curTop = $("#turn").offset().top;
        var top = $(".big_table").position().top;
        var left = $(".big_table").offset().left;

        $("#turn").css({
            "position": "absolute",
            "left": left + "px",
            "top": curTop + "px"
        });

        $("#turn").text("");

        $("#turn").animate({
            top: top + "px",
            height: "560px",
            opacity: 0.85
        }, 500, function() {
            showNewGame();
        });
    }

    function showNewGame() {
        $("#newGame").css('display', 'block').hide().fadeIn(500);
    }

    function threeInRow(markers) {
        return (($(markers).filter(".row-1").length === 3) || ($(markers).filter(".row-2").length === 3) || ($(markers).filter(".row-3").length === 3));
    }

    function threeInColumn(markers) {
        return (($(markers).filter(".col-1").length === 3) || ($(markers).filter(".col-2").length === 3) || ($(markers).filter(".col-3").length === 3));
    }

    function threeInDiagonal(markers) {
        //No middle marker
        if($(markers).filter(".col-2").filter(".row-2").length === 0) {
            return false;
        }

        if($(markers).filter(".col-1").filter(".row-1").length === 1 && $(markers).filter(".col-3").filter(".row-3").length === 1) {
            return true;
        }

        if($(markers).filter(".col-1").filter(".row-3").length === 1 && $(markers).filter(".col-3").filter(".row-1").length === 1) {
            return true;
        }

        return false;
    }
</script>